# Telegram Mini App —Å WebSocket –ß–∞—Ç–æ–º –Ω–∞ FastAPI

–≠—Ç–æ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram Mini App —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI –∏ WebSockets. –ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä, —Å–æ–∑–¥–∞–µ—Ç –∫ –Ω–µ–º—É –ø—É–±–ª–∏—á–Ω—ã–π HTTPS-—Ç—É–Ω–Ω–µ–ª—å —Å –ø–æ–º–æ—â—å—é `tuna` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Telegram-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —ç—Ç–æ–≥–æ Mini App.

### ü•û –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

  * **–ë—ç–∫–µ–Ω–¥:** Python, FastAPI, Uvicorn
  * **–í–µ–±-—Å–æ–∫–µ—Ç—ã:** FastAPI WebSockets
  * **–ë–æ—Ç:** Aiogram 3.x
  * **–¢—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** [Tuna](https://www.google.com/search?q=https://github.com/a-bali/tuna) (–¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è `localhost` –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
  * **–§—Ä–æ–Ω—Ç–µ–Ω–¥:** HTML, Jinja2, JavaScript

-----

## üöÄ 1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python 3.9+ –∏ Git.

### 1.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Powarar/ws-messenger.git
cd your-project-directory
```

### 1.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python -m venv venv
source venv/bin/activate  # (–¥–ª—è Linux/macOS)
venv\Scripts\activate     # (–¥–ª—è Windows)
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```bash
pip install fastapi uvicorn "aiogram>=3.0.0" python-dotenv jinja2
```

### 1.3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `tuna`

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tuna` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É–Ω–Ω–µ–ª—è. –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `tuna` –≤ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

–°–ª–µ–¥—É–π—Ç–µ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Tuna](https://www.google.com/search?q=https://github.com/a-bali/tuna%3Ftab%3Dreadme-ov-file%23installation).

-----

## ‚öôÔ∏è 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–æ–µ–∫—Ç—É –Ω—É–∂–µ–Ω –æ–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

1.  –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞.

2.  –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ —Ç–æ–∫–µ–Ω.

3.  –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `.env`:

    ```.env
    BOT_TOKEN=123456:ABC-DEF1234567890
    ```

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `WEB_APP_URL` **–Ω–µ** –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ. –°–∫—Ä–∏–ø—Ç `tunnel_launcher.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –µ–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

-----

## ‚ñ∂Ô∏è 3. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¢—É–Ω–Ω–µ–ª—å, FastAPI —Å–µ—Ä–≤–µ—Ä, Telegram –±–æ—Ç) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
python main.py
```

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

1.  **–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è `tuna`** –∏ —Å–æ–∑–¥–∞—Å—Ç –ø—É–±–ª–∏—á–Ω—ã–π HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://1q8trk-95-24-128-130.ru.tuna.am`).
2.  –≠—Ç–æ—Ç URL –±—É–¥–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å–∞–Ω** –≤ –≤–∞—à `.env` —Ñ–∞–π–ª –∫–∞–∫ `WEB_APP_URL`.
3.  **–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è `uvicorn`**, –≤–∞—à FastAPI —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `localhost:8000` (–∏, –±–ª–∞–≥–æ–¥–∞—Ä—è `tuna`, –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É URL).
4.  (–ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥) **–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è Telegram-–±–æ—Ç**. –û–Ω –ø—Ä–æ—á–∏—Ç–∞–µ—Ç `WEB_APP_URL` –∏–∑ `.env` –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å Web App".

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–π—Ç–∏ –≤ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram, –Ω–∞–∂–∞—Ç—å `/start`, –∏ Mini App –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.

-----

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/
‚îú‚îÄ‚îÄ main.py               # üöÄ –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ .env                  # (–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å) –§–∞–π–ª —Å BOT_TOKEN
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ router_page.py    # –†–æ—É—Ç–µ—Ä FastAPI –¥–ª—è HTML —Å—Ç—Ä–∞–Ω–∏—Ü
‚îÇ   ‚îî‚îÄ‚îÄ router_socket.py  # –†–æ—É—Ç–µ—Ä FastAPI –¥–ª—è WebSocket —á–∞—Ç–∞
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ bot_launcher.py   # –õ–æ–≥–∏–∫–∞ Telegram-–±–æ—Ç–∞ (Aiogram)
‚îÇ   ‚îî‚îÄ‚îÄ tunnel_launcher.py# –õ–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ç—É–Ω–Ω–µ–ª—è (Tuna)
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js      # üíª –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π JavaScript –¥–ª—è —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îú‚îÄ‚îÄ home.html     # –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ       ‚îî‚îÄ‚îÄ index.html    # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–º–æ–≥–æ —á–∞—Ç–∞
‚îî‚îÄ‚îÄ requirements.txt      #
```